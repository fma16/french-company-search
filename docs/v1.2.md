# Features à implémenter
- [ ] Renvoyer vers la page Pappers de l'entreprise par le biais d'un raccourci (cmd + enter?).
- [ ] Récupérer le contenu du presse-papier dès le lancement de l'extension, afin de générer le résultat plus rapidement.
- [ ] Permettre à l'utilisateur de créer des templates personnalisés.

# Plan de Développement
## Raccourci vers la page Pappers

### 1. Objectif

Offrir un raccourci clavier (`cmd+enter`) qui ouvre immédiatement la page Pappers de l'entreprise sélectionnée afin d'accélérer la consultation des informations détaillées.

### 2. Schéma de la Fonctionnalité

#### a. Construction de l'URL Pappers

-   **Données nécessaires :** `siren` ou `siret` de l'entreprise courante.
-   **Service concerné :** `src/services/link-builder.ts` (à introduire si besoin) ou logique locale dans le composant de résultat.
-   **Action :** Générer l'URL Pappers (`https://www.pappers.fr/recherche?q=<SIREN>`).

#### b. Intégration dans Raycast

-   **Fichier cible :** `src/search-company.tsx` (ou composant équivalent listant les entreprises).
-   **ActionPanel :** Ajouter une action secondaire `Action.OpenInBrowser` utilisant l'URL générée.
-   **Raccourci :** Assigner `cmd+enter` via la propriété `shortcut` de l'action.

#### c. Gestion des Cas Limites

-   Désactiver l'action si aucune entreprise n'est sélectionnée ou si l'identifiant nécessaire est manquant.
-   Ajouter un toast d'erreur pour informer l'utilisateur lorsque l'ouverture de la page échoue.

### 3. Validation

-   Tester manuellement sur plusieurs entreprises pour vérifier la construction correcte des URLs.
-   Vérifier que le raccourci n'entre pas en conflit avec d'autres actions existantes.

## Pré-remplissage via Presse-papiers

### 1. Objectif

Récupérer automatiquement le contenu du presse-papiers au lancement de l'extension afin de pré-remplir la recherche (SIREN, SIRET ou raison sociale) et déclencher la requête plus rapidement.

### 2. Schéma de la Fonctionnalité

#### a. Lecture Initiale

-   **API Raycast :** Utiliser `Clipboard.readText()` lors du `useEffect` initial du composant de recherche.
-   **Validation :** Nettoyer la valeur (trim, retirer espaces) et vérifier qu'elle correspond à un pattern attendu (SIREN/SIRET ou texte libre).

#### b. Déclenchement de la Recherche

-   **État :** Initialiser l'état de la barre de recherche avec la valeur validée.
-   **Action :** Lancer automatiquement la requête s'il s'agit d'un SIREN/SIRET valide, sinon laisser l'utilisateur confirmer la recherche.
-   **Préférence :** Introduire un toggle `autoReadClipboard` dans `package.json` pour permettre à l'utilisateur de désactiver ce comportement.

#### c. Gestion des Erreurs

-   Afficher un toast si l'accès au presse-papiers échoue.
-   Ajouter des garde-fous pour ne pas exécuter la requête si la valeur récupérée est trop longue ou contient des caractères non valides.

### 3. Validation

-   Tester le lancement de l'extension avec différents contenus de presse-papiers.
-   Vérifier l'impact sur les performances et s'assurer que la requête ne se déclenche pas en boucle.

## Template de Réponse Personnalisable

### 1. Objectif

Permettre aux utilisateurs de définir un template personnalisé pour le formatage de la sortie des détails d'une entreprise. Cela offrira une plus grande flexibilité pour adapter l'extension aux besoins spécifiques de chacun.

### 2. Schéma de la Fonctionnalité

#### a. Préférences Utilisateur

-   **Action :** Ajouter une nouvelle préférence dans le fichier `package.json`.
-   **Type :** `textarea` pour permettre un contenu sur plusieurs lignes.
-   **Nom :** `outputTemplate`
-   **Label :** "Output Template"
-   **Description :** "Define your custom output template. Use {{variable}} for placeholders. See documentation for available variables."
-   **Défaut :** Nous garderons le format actuel comme template par défaut.

#### b. Stockage et Accès

-   Le template sera stocké et géré par Raycast via les préférences.
-   L'accès se fera en utilisant `getPreferenceValues<{ outputTemplate: string }>()` de l'API `@raycast/api`.
-   Un template par défaut sera codé en dur dans `src/services/markdown-builder.ts` et utilisé si la préférence est vide.

#### c. Logique de Templating

-   **Service concerné :** `src/services/markdown-builder.ts`
-   **Logique :**
    1.  Récupérer le template depuis les préférences.
    2.  Si le template est vide, utiliser le template par défaut.
    3.  Récupérer les données formatées de l'entreprise.
    4.  Itérer sur les clés des données et remplacer les placeholders correspondants (ex: `{{siren}}`) dans le template par les valeurs réelles.
    5.  Retourner le Markdown final.

### 3. Analyse des Variables Disponibles

Cette étape est cruciale pour la documentation et l'utilité de la fonctionnalité.

-   **Action :**
    1.  Analyser en profondeur les types de données dans `src/types.ts`, notamment `Company`, `FormattedData`, et les sous-objets.
    2.  Effectuer un appel à l'API INPI avec un SIREN connu et analyser la réponse JSON complète pour identifier tous les champs disponibles.
    3.  Dresser une liste exhaustive de toutes les variables possibles (ex: `nom_complet`, `siren`, `siret`, `adresse_complete`, `ville`, `capital_social`, `date_creation`, `nom_representant`, `role_representant`, etc.).
    4.  Cette liste sera ajoutée à la documentation de l'extension (README.md).

### 4. Plan d'Action Séquentiel

1.  **Branche Git :** Créer la branche `v1.2` (fait).
2.  **Raccourci Pappers :**
    -   Mettre à jour le composant de recherche pour générer l'URL Pappers et ajouter l'action Raycast.
    -   Gérer l'état désactivé et les toasts d'erreur.
3.  **Lecture Presse-papiers :**
    -   Introduire le toggle `autoReadClipboard` dans `package.json` et l'utiliser via `getPreferenceValues`.
    -   Initialiser la recherche avec `Clipboard.readText()` et gérer les validations d'input.
4.  **Template Personnalisé :**
    -   Effectuer l'analyse des variables disponibles.
    -   Mettre à jour `package.json` et `markdown-builder.ts` pour supporter le templating personnalisé.
5.  **Documentation :**
    -   Expliquer le raccourci Pappers, la lecture du presse-papiers et les templates personnalisés dans `README.md`.
    -   Ajouter la liste complète des variables de template disponibles.
6.  **Tests & QA :**
    -   Vérifier le fonctionnement du raccourci et des URLs Pappers.
    -   Tester le démarrage avec différents contenus de presse-papiers.
    -   Couvrir les scénarios par défaut et personnalisés pour les templates.
