# Features à implémenter
- [X] Renvoyer vers la page Pappers de l'entreprise par le biais d'un raccourci (cmd + enter?).
- [X] Récupérer le contenu du presse-papier dès le lancement de l'extension, afin de générer le résultat plus rapidement.
- [ ] Permettre de sélectionner entre un résultat en français et un résultat en anglais par le biais d'une option au sein de l'action panel.

# Plan de Développement
## Raccourci vers la page Pappers

### 1. Objectif

Offrir un raccourci clavier (`cmd+enter`) qui ouvre immédiatement la page Pappers de l'entreprise sélectionnée afin d'accélérer la consultation des informations détaillées.

### 2. Schéma de la Fonctionnalité

#### a. Construction de l'URL Pappers

- **Données nécessaires :** `siren` ou `siret` de l'entreprise courante.
- **Service concerné :** `src/services/link-builder.ts` (à introduire si besoin) ou logique locale dans le composant de résultat.
- **Action :** Générer l'URL Pappers (`https://www.pappers.fr/recherche?q=<SIREN>`).

#### b. Intégration dans Raycast

- **Fichier cible :** `src/search-company.tsx` (ou composant équivalent listant les entreprises).
- **ActionPanel :** Ajouter une action secondaire `Action.OpenInBrowser` utilisant l'URL générée.
- **Raccourci :** Assigner `cmd+enter` via la propriété `shortcut` de l'action.

#### c. Gestion des Cas Limites

- Désactiver l'action si aucune entreprise n'est sélectionnée ou si l'identifiant nécessaire est manquant.
- Ajouter un toast d'erreur pour informer l'utilisateur lorsque l'ouverture de la page échoue.

### 3. Validation

- Tester manuellement sur plusieurs entreprises pour vérifier la construction correcte des URLs.
- Vérifier que le raccourci n'entre pas en conflit avec d'autres actions existantes.

## Pré-remplissage via Presse-papiers

### 1. Objectif

Récupérer automatiquement le contenu du presse-papiers au lancement de l'extension afin de pré-remplir la recherche (SIREN, SIRET ou raison sociale) et déclencher la requête plus rapidement.

### 2. Schéma de la Fonctionnalité

#### a. Lecture Initiale

- **API Raycast :** Utiliser `Clipboard.readText()` lors du `useEffect` initial du composant de recherche.
- **Validation :** Nettoyer la valeur (trim, retirer espaces) et vérifier qu'elle correspond à un pattern attendu (SIREN/SIRET ou texte libre).

#### b. Déclenchement de la Recherche

- **État :** Initialiser l'état de la barre de recherche avec la valeur validée.
- **Action :** Lancer automatiquement la requête s'il s'agit d'un SIREN/SIRET valide, sinon laisser l'utilisateur confirmer la recherche.
- **Préférence :** Introduire un toggle `autoReadClipboard` dans `package.json` pour permettre à l'utilisateur de désactiver ce comportement.

#### c. Gestion des Erreurs

- Afficher un toast si l'accès au presse-papiers échoue.
- Ajouter des garde-fous pour ne pas exécuter la requête si la valeur récupérée est trop longue ou contient des caractères non valides.

### 3. Validation

- Tester le lancement de l'extension avec différents contenus de presse-papiers.
- Vérifier l'impact sur les performances et s'assurer que la requête ne se déclenche pas en boucle.

## Template de Réponse Personnalisable

### 1. Objectif

Fournir un éditeur dédié calqué sur le layout « résultat Raycast » : texte éditable à gauche, liste des placeholders à droite, afin de faciliter la personnalisation tout en documentant visuellement les variables disponibles.

### 2. Schéma de la Fonctionnalité

#### a. Vue `TemplateEditor` en deux colonnes

- **Composant principal :** créer une vue poussée via `Action.Push` utilisant `Detail`.
- **Colonne gauche :** injecter un petit formulaire (ex. `Form` + `Form.TextArea` contrôlé) en tant que `children` du `Detail`. Gérer la valeur via `useState`, `enableDrafts` et un raccourci `⌘S` pour sauvegarder.
- **Colonne droite :** alimenter `Detail.Metadata` à partir de `AVAILABLE_TEMPLATE_VARIABLES` : chaque groupe (`common`, `personneMorale`, `personnePhysique`) devient une section avec labels + séparateurs.

#### b. Persistance et communication

- Initialiser l'éditeur avec la valeur stockée (préférence `outputTemplate` ou state existant dans `SearchForm`).
- À la sauvegarde :
  - Nettoyer la saisie (trim) et mettre à jour l'état parent.
  - Optionnel : écrire la nouvelle valeur dans les préférences Raycast pour persistance cross-session.
  - Afficher un toast de succès puis `pop()` la vue d'édition.
- Propager la valeur mise à jour vers `CompanyDetail` / `CompanyDetailsView` pour que `buildMarkdownAsync` rende le template modifié.

#### c. Expériences additionnelles

- Ajouter un `ActionPanel.Submenu` « Insert Placeholder » qui insère la variable sélectionnée dans le texte (via une ref sur le `Form.TextArea`).
- Fournir une action « Reset template » qui vide le champ et restaure la valeur par défaut.
- Ajouter un `Form.LinkAccessory` (ou `Detail.Metadata.Link`) renvoyant vers la documentation complète des placeholders.

### 3. Analyse des Variables Disponibles

- **Action :**
  1. Analyser en profondeur les types de données dans `src/types.ts`, notamment `CompanyData` et les sous-objets formatés.
  2. Effectuer un appel à l'API INPI avec un SIREN connu et analyser la réponse JSON complète pour identifier tous les champs disponibles.
  3. Dresser une liste exhaustive de toutes les variables possibles (ex: `nom_complet`, `siren`, `siret`, `adresse_complete`, `ville`, `capital_social`, `date_creation`, `nom_representant`, `role_representant`, etc.).
  4. Mettre à jour `AVAILABLE_TEMPLATE_VARIABLES` si de nouveaux placeholders sont exposables.
  5. Ajouter cette liste dans la documentation de l'extension (README.md).

### 4. Plan d'Action Séquentiel

1. **Branche Git :** Créer la branche `v1.2` (fait).
2. **Raccourci Pappers :**
   - Mettre à jour le composant de recherche pour générer l'URL Pappers et ajouter l'action Raycast.
   - Gérer l'état désactivé et les toasts d'erreur.
3. **Lecture Presse-papiers :**
   - Introduire le toggle `autoReadClipboard` dans `package.json` et l'utiliser via `getPreferenceValues`.
   - Initialiser la recherche avec `Clipboard.readText()` et gérer les validations d'input.
4. **Template Personnalisé :**
   - Implémenter l'éditeur en deux colonnes (`Detail` + metadata) et le flux de sauvegarde décrit ci-dessus.
   - Étendre `markdown-builder` si nécessaire pour supporter les nouveaux placeholders / fallback logic.
5. **Documentation :**
   - Expliquer le raccourci Pappers, la lecture du presse-papiers et le nouvel éditeur de template dans `README.md`.
   - Ajouter la liste complète des variables de template disponibles.
6. **Tests & QA :**
   - Vérifier le fonctionnement du raccourci et des URLs Pappers.
   - Tester le démarrage avec différents contenus de presse-papiers.
   - Couvrir les scénarios par défaut et personnalisés pour les templates (incluant sauvegarde/reset et rendu dans `CompanyDetailsView`).
